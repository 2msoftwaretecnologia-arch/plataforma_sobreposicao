{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload de ZIP e CAR</title>
    <link rel="stylesheet" type="text/css" href="{% static 'homepage/css/upload.css' %}">
</head>
<body>
    <div class="container">
        <h1>Upload de ZIP e CAR</h1>

        <div class="upload-card">
            <form method="post" enctype="multipart/form-data" id="upload_form">
                {% csrf_token %}
                <div class="form-group">
                    <label>Modo de an√°lise</label>
                    <div style="display:flex;gap:14px;align-items:center;">
                        <label style="display:flex;align-items:center;gap:6px;">
                            <input type="radio" name="modo" id="modo_zip" value="zip">
                            Enviar ZIP
                        </label>
                        <label style="display:flex;align-items:center;gap:6px;">
                            <input type="radio" name="modo" id="modo_car" value="car">
                            Informar n√∫mero do CAR
                        </label>
                    </div>
                    <small style="display:block;color:#666;margin-top:6px;">Escolha um modo. Voc√™ deve enviar um ZIP <strong>ou</strong> informar o n√∫mero do CAR.</small>
                </div>

                <div class="form-group" id="group_zip">
                    <label for="zip_file">Arquivo ZIP</label>
                    <input class="file-input" type="file" id="zip_file" name="zip_file" accept=".zip">
                    <small style="display:block;color:#666;margin-top:6px;">Envie um ZIP contendo um shapefile v√°lido.</small>
                </div>

                <div class="form-group" id="group_car">
                    <label for="car_input">N√∫mero do CAR</label>
                    <input type="text" id="car_input" name="car_input" placeholder="Digite o n√∫mero do CAR" value="{% if car_input %}{{ car_input }}{% endif %}">
                </div>

                <button type="submit">üöÄ Analisar</button>
            </form>

            <div id="client_error" class="status-error" style="display:none;">‚ùå Por favor, envie um ZIP ou informe o n√∫mero do CAR.</div>

            {% if sucesso %}
                <div class="status-success">‚úÖ {{ mensagem }}</div>
            {% endif %}
            {% if erro %}
                <div class="status-error">‚ùå {{ erro }}</div>
            {% endif %}

            <div class="actions" style="margin-top: 16px;">
                <a href="{% url 'homepage' %}">‚¨ÖÔ∏è Voltar para Home</a>
            </div>
        </div>
    </div>
    
    <script>
        (function() {
            const modoZip = document.getElementById('modo_zip');
            const modoCar = document.getElementById('modo_car');
            const groupZip = document.getElementById('group_zip');
            const groupCar = document.getElementById('group_car');
            const zipInput = document.getElementById('zip_file');
            const carInput = document.getElementById('car_input');
            const clientError = document.getElementById('client_error');
            const form = document.getElementById('upload_form');

            function applyMode() {
                if (modoZip.checked) {
                    groupZip.style.display = '';
                    groupCar.style.display = 'none';
                    carInput.required = false;
                    zipInput.required = true;
                } else if (modoCar.checked) {
                    groupZip.style.display = 'none';
                    groupCar.style.display = '';
                    zipInput.required = false;
                    carInput.required = true;
                } else {
                    groupZip.style.display = '';
                    groupCar.style.display = '';
                    zipInput.required = false;
                    carInput.required = false;
                }
                clientError.style.display = 'none';
            }

            modoZip.addEventListener('change', applyMode);
            modoCar.addEventListener('change', applyMode);

            const carPrefilled = (carInput.value || '').trim().length > 0;
            if (carPrefilled) {
                modoCar.checked = true;
            } else {
                modoZip.checked = true;
            }
            applyMode();

            form.addEventListener('submit', function(e) {
                const zipSelectedEmpty = modoZip.checked && (!zipInput.files || zipInput.files.length === 0);
                const carSelectedEmpty = modoCar.checked && (carInput.value.trim() === '');
                const noneSelectedEmpty = !modoZip.checked && !modoCar.checked && (!zipInput.files || zipInput.files.length === 0) && (carInput.value.trim() === '');

                if (zipSelectedEmpty || carSelectedEmpty || noneSelectedEmpty) {
                    e.preventDefault();
                    clientError.style.display = 'block';
                    clientError.textContent = '‚ùå Por favor, envie um ZIP ou informe o n√∫mero do CAR.';
                }
            });
        })();
    </script>
</body>
</html>